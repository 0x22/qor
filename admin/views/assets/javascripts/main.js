!function(t){"function"==typeof define&&define.amd?define("qor-cropper",["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";var o=window.URL||window.webkitURL,e=function(o,i){this.$element=t(o),this.options=t.extend(!0,{},e.DEFAULTS,i),this.built=!1,this.url=null,this.init()};return e.prototype={constructor:e,init:function(){var o,e,i,r=this.$element,a=this.options;if(a.parent&&(o=r.closest(a.parent)),o.length||(o=r.parent()),a.target&&(e=o.find(a.target)),e.length||(e=t("<img>")),a.output){this.$output=o.find(a.output);try{i=JSON.parse(this.$output.val())}catch(n){console.log(n.message)}}this.$parent=o,this.$image=e,this.data=i||{},this.load(e.data("originalUrl")||e.prop("src")),r.on("change",t.proxy(this.read,this))},read:function(){var t,e=this.$element.prop("files");e&&(t=e[0],/^image\/\w+$/.test(t.type)&&o&&this.load(o.createObjectURL(t),!0))},load:function(t,e){t&&(this.built||this.build(),/^blob:\w+/.test(this.url)&&o&&o.revokeObjectURL(this.url),this.url=t,e&&(this.data[this.options.key]=null,this.$image.attr("src",t)))},build:function(){this.built||(this.built=!0,this.$cropper=t(e.TEMPLATE).prepend(this.$image).appendTo(this.$parent),this.$cropper.find(".modal").on({"shown.bs.modal":t.proxy(this.start,this),"hidden.bs.modal":t.proxy(this.stop,this)}))},start:function(){var o=this.$cropper.find(".modal"),e=t("<img>").attr("src",this.url),i=this.data,r=this.options.key,a=this;o.find(".modal-body").html(e),e.cropper({background:!1,zoomable:!1,rotatable:!1,built:function(){var n,s,d,p=i[r],l={};t.isPlainObject(p)&&(s=e.cropper("getImageData"),d=e.cropper("getCanvasData"),n=s.width/s.naturalWidth,t.each(p,function(t,o){l[String(t).toLowerCase()]=o*n}),e.cropper("setCropBoxData",{left:l.x+d.left,top:l.y+d.top,width:l.width,height:l.height})),o.find(".qor-cropper-save").one("click",function(){var t=e.cropper("getData");i[r]={x:Math.round(t.x),y:Math.round(t.y),width:Math.round(t.width),height:Math.round(t.height)},a.output(e.cropper("getCroppedCanvas").toDataURL()),o.modal("hide")})}})},stop:function(){this.$cropper.find(".modal-body > img").cropper("destroy").remove()},output:function(o){var e=t.extend({},this.data,this.options.data);this.$image.attr("src",o),this.$output.val(JSON.stringify(e))},destroy:function(){this.$element.off("change"),this.$cropper.find(".modal").off("shown.bs.modal hidden.bs.modal")}},e.DEFAULTS={target:"",output:"",parent:"",key:"qorCropper",data:null},e.TEMPLATE='<div class="qor-cropper"><a class="qor-cropper-toggle" data-toggle="modal" href="#qorCropperModal" title="Crop the image"><span class="sr-only">Toggle Cropper<span></a><div class="modal fade qor-cropper-modal" id="qorCropperModal" tabindex="-1" role="dialog" aria-labelledby="qorCropperModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="qorCropperModalLabel">Crop the image</h5></div><div class="modal-body"></div><div class="modal-footer"><button type="button" class="btn btn-link" data-dismiss="modal">Cancel</button><button type="button" class="btn btn-link qor-cropper-save">OK</button></div></div></div></div></div>',t(function(){t(".qor-file-input").each(function(){var o=t(this);o.data("qor.cropper")||o.data("qor.cropper",new e(this,{target:".qor-file-image",output:".qor-file-options",parent:".form-group",key:"CropOption",data:{Crop:!0}}))})}),e}),function(t){"function"==typeof define&&define.amd?define("qor-redactor",["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function o(o,e){var i=[];return t.isPlainObject(e)&&t.each(e,function(t,o){i.push([t,o].join("="))}),[o,i.join("&")].join("?")}function e(o){var e={url:o,data:{}};return"string"==typeof o&&(o=o.split("?"),e.url=o[0],o[1]&&t.each(o[1].split("&"),function(t,o){o=o.split("="),e.data[o[0]]=parseFloat(o[1])})),e}var i=/x|y|width|height/,r=function(o,e){this.$element=t(o),this.options=t.extend(!0,{},r.DEFAULTS,e),this.built=!1,this.init()};return r.prototype={constructor:r,init:function(){var o,e,i=this,a=this.$element,n=this.options;n.parent&&(o=a.closest(n.parent)),o.length||(o=a.parent()),e=t(r.BUTTON),o.on("click","img",function(o){var r=t(this),a=o.originalEvent;a&&(a.qorCropperReady=!0),e.insertBefore(r).one("click",function(){i.crop(r)})}),t("body").on("click",function(t){var o=t.originalEvent;o&&!o.qorCropperReady&&e.detach()})},crop:function(a){var n=this.options,s=e(a.attr("src")),d=s.url,p=t("<img>"),l=t(r.TEMPLATE);t.isFunction(n.replace)&&(d=n.replace(d)),p.attr("src",d),l.appendTo("body").modal("show").find(".modal-body").append(p),l.one("shown.bs.modal",function(){p.cropper({background:!1,zoomable:!1,rotatable:!1,built:function(){var e,r,d=s.data;d&&!t.isEmptyObject(d)&&(r=p.cropper("getImageData"),e=p.cropper("getCanvasData"),r.ratio=r.width/r.naturalWidth,p.cropper("setCropBoxData",{left:d.x*r.ratio+e.left,top:d.y*r.ratio+e.top,width:d.width*r.ratio,height:d.height*r.ratio})),l.find(".qor-cropper-save").one("click",function(){var e={};t.each(p.cropper("getData"),function(t,o){i.test(t)&&(e[t]=Math.round(o))}),t.ajax(n.remote,{type:"POST",contentType:"application/json",data:JSON.stringify({Url:s.url,CropOption:e,Crop:!0}),dataType:"json",success:function(i){t.isPlainObject(i)&&i.url&&(a.attr("src",o(i.url,e)).removeAttr("style").removeAttr("rel"),t.isFunction(n.complete)&&n.complete(),l.modal("hide"))},error:function(){console.log(arguments)}})})}})}).one("hidden.bs.modal",function(){p.cropper("destroy").remove(),l.remove()})}},r.DEFAULTS={remote:!1,parent:!1,replace:null,complete:null},r.BUTTON='<span id="redactor-image-cropper">Crop</span>',r.TEMPLATE='<div class="modal fade qor-cropper-modal" id="qorCropperModal" tabindex="-1" role="dialog" aria-labelledby="qorCropperModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="qorCropperModalLabel">Crop the image</h5></div><div class="modal-body"></div><div class="modal-footer"><button type="button" class="btn btn-link" data-dismiss="modal">Cancel</button><button type="button" class="btn btn-link qor-cropper-save">OK</button></div></div></div></div>',t(function(){t(".qor-text-editor").each(function(){var o=t(this),e=o.data();o.redactor({imageUpload:e.uploadUrl,fileUpload:e.uploadUrl,initCallback:function(){o.data("qor.redactor")||o.data("qor.redactor",new r(o,{remote:e.cropUrl,parent:".redactor-editor",replace:function(t){return t.replace(/\.\w+$/,function(t){return console.log(arguments),".original"+t})},complete:t.proxy(function(){this.code.sync()},this)}))}})})}),r}),function(t){"function"==typeof define&&define.amd?define("qor",["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";var o=t(window),e=function(){this.init()};e.prototype={constructor:e,init:function(){this.initNavbar(),this.initFooter(),this.initConfirm()},initNavbar:function(){var o=t(".navbar");o.find(".dropdown").on({mouseover:function(){t(this).addClass("open")},mouseout:function(){t(this).removeClass("open")}})},initFooter:function(){var e=t(".footer"),i=t("body");o.on("resize",function(){var t=o.innerHeight();i.height()>=t?e.addClass("static"):e.removeClass("static")}).triggerHandler("resize")},initConfirm:function(){t("[data-confirm]").click(function(o){var e=t(this).data("confirm");e&&!window.confirm(e)&&o.preventDefault()})}},t(function(){t(".main").data("qor",new e)})});