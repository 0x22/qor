!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function i(n,o){this.$element=t(n),this.options=t.extend({},i.DEFAULTS,t.isPlainObject(o)&&o),this.$source=null,this.ascending=!0,this.init()}var n=window.location,o="qor.sorting",e="enable."+o,r="disable."+o,s="change."+o,a="mousedown."+o,d="mouseup."+o,u="dragstart."+o,p="dragover."+o,f="drop."+o,c="qor-sorting",l="qor-sorting__highlight",h="tbody> tr";return i.prototype={constructor:i,init:function(){var n=this.options,o=this.$element,e=o.find(h),r=e.first().find(n.input).data("position"),s=e.last().find(n.input).data("position");t("body").addClass(c),o.find("tbody .qor-table__actions").append(i.TEMPLATE),this.ascending=s>r,this.bind()},bind:function(){var i=this.options;this.$element.on(s,i.input,t.proxy(this.change,this)).on(a,i.toggle,t.proxy(this.mousedown,this)).on(d,t.proxy(this.mouseup,this)).on(u,h,t.proxy(this.dragstart,this)).on(p,h,t.proxy(this.dragover,this)).on(f,h,t.proxy(this.drop,this))},unbind:function(){this.$element.off(s,this.change).off(a,this.mousedown)},change:function(i){var n,o,e=this.options,r=this.$element.find(h),s=t(i.currentTarget),a=s.closest("tr"),d=a.parent(),u=s.data(),p=u.position,f=parseInt(s.val(),10),c=f>p,l=this.ascending;r.each(function(i){var o=t(this),r=o.find(e.input),s=r.data("position");s===f&&(n=i),c?s>p&&f>=s&&r.data("position",--s).val(s):p>s&&s>=f&&r.data("position",++s).val(s)}),s.data("position",f),"number"==typeof n?(o=r.eq(n),c?l?o.after(a):o.before(a):l?o.before(a):o.after(a)):c?l?d.append(a):d.prepend(a):l?d.prepend(a):d.append(a),this.sort(a,{url:u.sortingUrl,from:p,to:f})},mousedown:function(i){t(i.currentTarget).closest("tr").prop("draggable",!0)},mouseup:function(){this.$element.find(h).prop("draggable",!1)},dragstart:function(i){var n=i.originalEvent,o=t(i.currentTarget);o.prop("draggable")&&n.dataTransfer&&(n.dataTransfer.effectAllowed="move",this.$source=o)},dragover:function(t){var i=this.$source;i&&t.currentTarget!==this.$source[0]&&t.preventDefault()},drop:function(i){var n,o,e,r,s,a,d=this.options,u=this.ascending,p=this.$source;p&&i.currentTarget!==this.$source[0]&&(i.preventDefault(),o=t(i.currentTarget),n=p.find(d.input),e=n.data(),r=e.position,s=o.find(d.input).data("position"),a=s>r,this.$element.find(h).each(function(){var i=t(this).find(d.input),n=i.data("position");a?n>r&&s>=n&&i.data("position",--n).val(n):r>n&&n>=s&&i.data("position",++n).val(n)}),n.data("position",s).val(s),a?u?o.after(p):o.before(p):u?o.before(p):o.after(p),this.sort(p,{url:e.sortingUrl,from:r,to:s}))},sort:function(i,o){var e=this.options;o.url&&(this.highlight(i),t.ajax(o.url,{method:"post",data:{from:o.from,to:o.to},success:function(t,n,o){200===o.status&&i.find(e.input).data("position",t).val(t)},error:function(t,i,o){422===t.status?window.confirm(t.responseText)&&n.reload():window.confirm([i,o].join(": "))&&n.reload()}}))},highlight:function(t){t.addClass(l),setTimeout(function(){t.removeClass(l)},2e3)},destroy:function(){this.unbind(),this.$element.removeData(o)}},i.DEFAULTS={toggle:!1,input:!1},i.TEMPLATE='<a class="qor-sorting__toggle"><i class="material-icons">swap_vert</i></a>',i.plugin=function(n){return this.each(function(){var e,r=t(this),s=r.data(o);if(!s){if(/destroy/.test(n))return;r.data(o,s=new i(this,n))}"string"==typeof n&&t.isFunction(e=s[n])&&e.apply(s)})},t(function(){if(/sorting\=true/.test(window.location.search)){var n=".qor-table",o={toggle:".qor-sorting__toggle",input:".qor-sorting__position"};t(document).on(r,function(o){i.plugin.call(t(n,o.target),"destroy")}).on(e,function(e){i.plugin.call(t(n,e.target),o)}).trigger("disable.qor.slideout").triggerHandler(e)}}),i});